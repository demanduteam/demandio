<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demandio Tools | Subsidy & ESG Suite</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Babel for JSX (Standalone) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Supabase Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }

        /* Custom Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.4s ease-out forwards;
        }

        /* Sidebar Active State */
        .nav-item-active {
            background-color: #eff6ff;
            color: #1d4ed8;
            border-right: 3px solid #1d4ed8;
        }
        
        .nav-item-inactive {
            color: #64748b;
        }
        .nav-item-inactive:hover {
            background-color: #f8fafc;
            color: #334155;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }
    </style>
</head>
<body class="h-screen overflow-hidden flex">
    <div id="root" class="w-full h-full"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect } from 'https://esm.sh/react@18.2.0';
        import { createRoot } from 'https://esm.sh/react-dom@18.2.0/client';
        import { 
            Car, Calculator, FileBarChart, ArrowLeft, CheckCircle, 
            X, Zap, Truck, Home, GraduationCap, ChevronRight,
            ShieldCheck, AlertTriangle, Calendar, Euro, FileText,
            Send, HelpCircle, User, LayoutDashboard, Settings, LogOut,
            Bell, Search
        } from 'https://esm.sh/lucide-react@0.292.0';

        // --- CONFIGURATION ---
        const SUPABASE_URL = 'https://byomcvqnuhpeazicirjg.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJ5b21jdnFudWhwZWF6aWNpcmpnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY3MjMxNzMsImV4cCI6MjA4MjI5OTE3M30.Bl5sahKsZ4nX0iiPT9tKmXm_Pq3bfAjLLiVYeS3oA2g';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        const App = () => {
            const [lang, setLang] = useState('nl');
            const [currentView, setCurrentView] = useState('dashboard'); // 'dashboard', 'subsidy', 'vsme'
            
            // --- SUBSIDY TOOL STATE ---
            const [subsidyStep, setSubsidyStep] = useState(1);
            const [subsidyData, setSubsidyData] = useState({
                hasEH3: null,
                recentPurchase: null,
                categories: [],
                invoiceValue: null,
                isElectricVehicle: null,
                isHeavyVehicle: null,
                smallStaff: null
            });

            // --- VSME TOOL STATE ---
            const [vsmeViewMode, setVsmeViewMode] = useState('setup'); // 'setup', 'wizard', 'report'
            const [vsmeStepIndex, setVsmeStepIndex] = useState(0); 
            const [vsmeStepsList, setVsmeStepsList] = useState([]);
            const [vsmeConfig, setVsmeConfig] = useState({ listed: false, bpModule: false, comprehensive: false });
            
            const [vsmeData, setVsmeData] = useState({
                isListed: 'no',
                reportPurpose: 'basic',
                hasPolicies: 'no',
                b1_name: '', b1_basis: 'Individual basis', b1_legal_form: '', b1_turnover: '', b1_employees: '',
                b2_practices: '',
                b3_energy_total: '', b3_energy_ren: '', b3_energy_nonren: '', b3_scope1: '', b3_scope2: '',
                b4_pollution: '', b5_sensitive: '', b6_water: '', b7_waste_haz: '', b7_waste_recycled: '',
                b8_perm: '', b8_temp: '', b8_female: '', b9_accidents: '', b10_minwage: 'Yes',
                b11_convictions: '', b11_fines: '',
                bp_code: 'No', bp_grievance: 'No', bp_payment: '', bp_excluded_rev: '', bp_scope3_status: 'Not Measured', bp_climate_risks: '',
                c1_strategy: '', c2_policies: '', c3_targets: '', c4_risks: '', c5_mgmt_gender: '', c6_policy: 'No', c7_incidents: 'None', c8_revenue: '', c9_board_gender: ''
            });

            const content = {
                en: {
                    logout: "Exit to Home",
                    dashboard: "Dashboard",
                    subsidy_tool: "Subsidy Finder",
                    vsme_tool: "VSME Report",
                    welcome: "Welcome back,",
                    start_new: "Start New Assessment",
                    recent_activity: "Recent Activity",
                    tool: {
                        step1: { title: "The Gatekeeper", q: "Do you have eHerkenning Level 3 (EH3)?", yes: "Yes, I have it", no: "No / Don't know", alert: "You need EH3 to apply for subsidies." },
                        step2: { title: "90-Day Rule", q: "Did you purchase equipment in the last 3 months?", yes: "Yes", no: "No" },
                        step3: { title: "Investment Details", msg: "Select the categories that apply to your investment:" },
                        step5: { title: "Eligibility Results", msg: "Based on your inputs, you qualify for:" },
                        step6: { title: "Next Steps", btn1: "Download ESG Kit", btn2: "Email Accountant" }
                    }
                },
                nl: {
                    logout: "Terug naar Home",
                    dashboard: "Dashboard",
                    subsidy_tool: "Subsidie Zoeker",
                    vsme_tool: "VSME Rapportage",
                    welcome: "Welkom terug,",
                    start_new: "Start Nieuwe Analyse",
                    recent_activity: "Recente Activiteit",
                    tool: {
                        step1: { title: "De Poortwachter", q: "Heeft u eHerkenning Niveau 3 (EH3)?", yes: "Ja, dat heb ik", no: "Nee / Weet ik niet", alert: "U heeft EH3 nodig voor subsidieaanvragen." },
                        step2: { title: "90-Dagen Regel", q: "Heeft u in de afgelopen 3 maanden geïnvesteerd?", yes: "Ja", no: "Nee" },
                        step3: { title: "Investering Details", msg: "Selecteer de categorieën die van toepassing zijn:" },
                        step5: { title: "Uw Potentieel", msg: "Op basis van uw antwoorden komt u in aanmerking voor:" },
                        step6: { title: "Volgende Stappen", btn1: "Download ESG Kit", btn2: "Mail Boekhouder" }
                    }
                }
            };

            const t = content[lang];
            const tt = content[lang].tool;

            // --- HELPERS ---
            const handleCategoryToggle = (cat) => {
                setSubsidyData(prev => ({
                    ...prev,
                    categories: prev.categories.includes(cat) ? prev.categories.filter(c => c !== cat) : [...prev.categories, cat]
                }));
            };

            const calculateSubsidies = () => {
                const results = [];
                if ((subsidyData.categories.includes('ev') && subsidyData.invoiceValue) || (subsidyData.categories.includes('building'))) {
                    results.push({ title: 'MIA/Vamil', desc: 'Fiscale aftrek tot 45%.' });
                }
                if (subsidyData.categories.includes('fleet') && subsidyData.isElectricVehicle && subsidyData.isHeavyVehicle) {
                    results.push({ title: 'SEBA', desc: 'Tot €5.000 cash subsidie.' });
                }
                if (subsidyData.categories.includes('training') && subsidyData.smallStaff) {
                    results.push({ title: 'SLIM', desc: '80% vergoeding opleidingskosten.' });
                }
                if (results.length === 0 && subsidyData.categories.length > 0) {
                    results.push({ title: 'General Check', desc: 'Neem contact op voor analyse.' });
                }
                return results;
            };

            const handleVsmeChange = (field, value) => {
                setVsmeData(prev => ({ ...prev, [field]: value }));
            };

            const startVsme = () => {
                const steps = ['gen', 'env', 'soc', 'gov'];
                if (vsmeData.reportPurpose === 'partner') steps.push('bp');
                if (vsmeData.hasPolicies === 'yes') steps.push('c1');
                steps.push('generate');
                
                setVsmeStepsList(steps);
                setVsmeConfig({ listed: vsmeData.isListed === 'yes', bpModule: vsmeData.reportPurpose === 'partner', comprehensive: vsmeData.hasPolicies === 'yes' });
                setVsmeViewMode('wizard');
                setVsmeStepIndex(0);
            };

            const saveReport = async () => {
                const { error } = await supabase.from('vsme_reports').insert([{ company_name: vsmeData.b1_name || 'Anonymous Garage', report_data: vsmeData }]);
                if (error) console.error('Save failed:', error);
            };

            const safeNavigate = (url) => {
                try {
                    window.location.href = url;
                } catch (e) {
                    console.log("Navigation prevented in preview mode:", url);
                }
            };

            // --- COMPONENTS ---

            const Sidebar = () => (
                <div className="w-64 bg-white border-r border-slate-200 h-full flex flex-col hidden md:flex shadow-sm z-20">
                    <div className="p-6 flex items-center gap-2 border-b border-slate-50">
                        <div className="bg-blue-600 p-1.5 rounded-lg text-white"><Car size={20} /></div>
                        <span className="font-bold text-lg tracking-tight text-slate-900">Demandio</span>
                    </div>
                    <div className="flex-1 py-6 px-3 space-y-1">
                        <button onClick={() => setCurrentView('dashboard')} className={`w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition ${currentView === 'dashboard' ? 'nav-item-active' : 'nav-item-inactive'}`}>
                            <LayoutDashboard size={18} /> {t.dashboard}
                        </button>
                        <button onClick={() => setCurrentView('subsidy')} className={`w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition ${currentView === 'subsidy' ? 'nav-item-active' : 'nav-item-inactive'}`}>
                            <Calculator size={18} /> {t.subsidy_tool}
                        </button>
                        <button onClick={() => setCurrentView('vsme')} className={`w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition ${currentView === 'vsme' ? 'nav-item-active' : 'nav-item-inactive'}`}>
                            <FileBarChart size={18} /> {t.vsme_tool}
                        </button>
                    </div>
                    <div className="p-4 border-t border-slate-100">
                        <button onClick={() => safeNavigate('index.html')} className="w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium text-slate-500 hover:text-red-600 hover:bg-red-50 transition">
                            <LogOut size={18} /> {t.logout}
                        </button>
                    </div>
                </div>
            );

            const Topbar = () => (
                <div className="h-16 bg-white border-b border-slate-200 flex items-center justify-between px-6 sticky top-0 z-10">
                    <div className="flex items-center gap-4">
                        <div className="relative md:w-64 hidden md:block">
                            <Search className="absolute left-3 top-2.5 text-slate-400 w-4 h-4" />
                            <input type="text" placeholder="Search tools..." className="w-full pl-9 pr-4 py-2 bg-slate-50 border border-slate-200 rounded-lg text-sm focus:ring-2 ring-blue-500 focus:outline-none" />
                        </div>
                    </div>
                    <div className="flex items-center gap-4">
                        <button onClick={() => setLang(l => l === 'en' ? 'nl' : 'en')} className="text-xs font-bold text-slate-500 bg-slate-100 px-2 py-1 rounded uppercase hover:bg-slate-200">{lang}</button>
                        <div className="w-8 h-8 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center font-bold text-xs">JD</div>
                    </div>
                </div>
            );

            const DashboardView = () => (
                <div className="p-8 animate-fade-in">
                    <div className="mb-8">
                        <h1 className="text-2xl font-bold text-slate-900">{t.welcome} Jan</h1>
                        <p className="text-slate-500">Here is what's happening with your garage today.</p>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <div className="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm">
                            <div className="flex justify-between items-start mb-4">
                                <div className="bg-green-100 p-2 rounded-lg text-green-600"><Euro size={20} /></div>
                                <span className="text-xs font-bold text-green-600 bg-green-50 px-2 py-1 rounded">+12%</span>
                            </div>
                            <h3 className="text-2xl font-bold text-slate-900">€4.250</h3>
                            <p className="text-sm text-slate-500">Potential Subsidies Found</p>
                        </div>
                        <div className="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm">
                            <div className="flex justify-between items-start mb-4">
                                <div className="bg-blue-100 p-2 rounded-lg text-blue-600"><FileText size={20} /></div>
                                <span className="text-xs font-bold text-slate-500 bg-slate-50 px-2 py-1 rounded">Draft</span>
                            </div>
                            <h3 className="text-2xl font-bold text-slate-900">VSME Report</h3>
                            <p className="text-sm text-slate-500">Last edited 2 days ago</p>
                        </div>
                    </div>

                    <h2 className="text-lg font-bold text-slate-900 mb-4">{t.start_new}</h2>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div onClick={() => setCurrentView('subsidy')} className="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm hover:shadow-md hover:border-green-300 transition cursor-pointer group">
                            <div className="flex items-center gap-4 mb-3">
                                <div className="bg-green-50 p-3 rounded-xl text-green-600"><Calculator size={24} /></div>
                                <h3 className="font-bold text-lg">{t.subsidy_tool}</h3>
                            </div>
                            <p className="text-slate-500 text-sm mb-4">Check eligibility for SEBA, MIA, and Vamil grants based on your purchases.</p>
                            <span className="text-green-600 text-sm font-bold flex items-center gap-1 group-hover:translate-x-1 transition-transform">Start Scan <ChevronRight size={16} /></span>
                        </div>
                        <div onClick={() => setCurrentView('vsme')} className="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm hover:shadow-md hover:border-blue-300 transition cursor-pointer group">
                            <div className="flex items-center gap-4 mb-3">
                                <div className="bg-blue-50 p-3 rounded-xl text-blue-600"><FileBarChart size={24} /></div>
                                <h3 className="font-bold text-lg">{t.vsme_tool}</h3>
                            </div>
                            <p className="text-slate-500 text-sm mb-4">Generate a bank-ready ESG report (EFRAG Standard) for loans and leasing.</p>
                            <span className="text-blue-600 text-sm font-bold flex items-center gap-1 group-hover:translate-x-1 transition-transform">Create Report <ChevronRight size={16} /></span>
                        </div>
                    </div>
                </div>
            );

            const SubsidyView = () => (
                <div className="p-8 max-w-3xl mx-auto animate-fade-in">
                    <div className="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                        <div className="bg-white border-b border-slate-100 p-6 flex justify-between items-center">
                            <h2 className="font-bold text-lg flex items-center gap-2"><Calculator size={20} className="text-green-600"/> {t.subsidy_tool}</h2>
                            <div className="flex gap-1">
                                {[1,2,3,4,5].map(s => <div key={s} className={`h-1 w-6 rounded-full ${s <= subsidyStep ? 'bg-green-500' : 'bg-slate-200'}`}></div>)}
                            </div>
                        </div>
                        
                        <div className="p-8">
                            {subsidyStep === 1 && (
                                <div className="text-center py-4">
                                    <div className="w-16 h-16 bg-blue-50 text-blue-600 rounded-full flex items-center justify-center mx-auto mb-6"><ShieldCheck size={32} /></div>
                                    <h3 className="text-xl font-bold mb-2">{tt.step1.title}</h3>
                                    <p className="text-slate-500 mb-8">{tt.step1.q}</p>
                                    <div className="flex gap-4 justify-center">
                                        <button onClick={() => { setSubsidyData({...subsidyData, hasEH3: true}); setSubsidyStep(2); }} className="px-6 py-3 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-700 transition">{tt.step1.yes}</button>
                                        <button onClick={() => setSubsidyData({...subsidyData, hasEH3: false})} className="px-6 py-3 bg-white border border-slate-200 text-slate-600 rounded-xl font-bold hover:bg-slate-50 transition">{tt.step1.no}</button>
                                    </div>
                                    {subsidyData.hasEH3 === false && <div className="mt-6 p-4 bg-orange-50 text-orange-800 rounded-xl text-sm flex items-center justify-center gap-2"><AlertTriangle size={16}/> {tt.step1.alert}</div>}
                                </div>
                            )}

                            {subsidyStep === 2 && (
                                <div className="text-center py-4">
                                    <div className="w-16 h-16 bg-orange-50 text-orange-600 rounded-full flex items-center justify-center mx-auto mb-6"><Calendar size={32} /></div>
                                    <h3 className="text-xl font-bold mb-2">{tt.step2.title}</h3>
                                    <p className="text-slate-500 mb-8">{tt.step2.q}</p>
                                    <div className="flex gap-4 justify-center">
                                        <button onClick={() => { setSubsidyData({...subsidyData, recentPurchase: true}); setSubsidyStep(3); }} className="px-6 py-3 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-700 transition">{tt.yes}</button>
                                        <button onClick={() => { setSubsidyData({...subsidyData, recentPurchase: false}); setSubsidyStep(3); }} className="px-6 py-3 bg-white border border-slate-200 text-slate-600 rounded-xl font-bold hover:bg-slate-50 transition">{tt.no}</button>
                                    </div>
                                </div>
                            )}

                            {subsidyStep === 3 && (
                                <div>
                                    <h3 className="text-xl font-bold mb-6">{tt.step3.msg}</h3>
                                    <div className="space-y-4">
                                        <div onClick={() => handleCategoryToggle('ev')} className={`p-4 border rounded-xl cursor-pointer flex justify-between items-center ${subsidyData.categories.includes('ev') ? 'border-blue-500 bg-blue-50/50' : 'hover:border-blue-300'}`}>
                                            <div className="flex items-center gap-3"><div className="p-2 bg-white rounded-lg border border-slate-100"><Zap size={20} className="text-slate-700"/></div><span className="font-medium">EV Equipment</span></div>
                                            {subsidyData.categories.includes('ev') && <CheckCircle className="text-blue-500" size={20} />}
                                        </div>
                                        <div onClick={() => handleCategoryToggle('fleet')} className={`p-4 border rounded-xl cursor-pointer flex justify-between items-center ${subsidyData.categories.includes('fleet') ? 'border-orange-500 bg-orange-50/50' : 'hover:border-orange-300'}`}>
                                            <div className="flex items-center gap-3"><div className="p-2 bg-white rounded-lg border border-slate-100"><Truck size={20} className="text-slate-700"/></div><span className="font-medium">Fleet (Vans)</span></div>
                                            {subsidyData.categories.includes('fleet') && <CheckCircle className="text-orange-500" size={20} />}
                                        </div>
                                        <div onClick={() => handleCategoryToggle('building')} className={`p-4 border rounded-xl cursor-pointer flex justify-between items-center ${subsidyData.categories.includes('building') ? 'border-green-500 bg-green-50/50' : 'hover:border-green-300'}`}>
                                            <div className="flex items-center gap-3"><div className="p-2 bg-white rounded-lg border border-slate-100"><Home size={20} className="text-slate-700"/></div><span className="font-medium">Building (Heat pump, LED)</span></div>
                                            {subsidyData.categories.includes('building') && <CheckCircle className="text-green-500" size={20} />}
                                        </div>
                                    </div>
                                    
                                    {/* Questions rendered conditionally */}
                                    {subsidyData.categories.includes('ev') && (
                                        <div className="mt-6 p-4 bg-slate-50 rounded-xl border border-slate-200 animate-fade-in">
                                            <p className="text-sm font-bold mb-3">{tt.step3.q_ev}</p>
                                            <div className="flex gap-2"><button onClick={() => setSubsidyData({...subsidyData, invoiceValue: true})} className={`px-3 py-1.5 text-xs rounded-lg border ${subsidyData.invoiceValue===true ? 'bg-blue-600 text-white border-blue-600' : 'bg-white'}`}>Yes</button><button onClick={() => setSubsidyData({...subsidyData, invoiceValue: false})} className={`px-3 py-1.5 text-xs rounded-lg border ${subsidyData.invoiceValue===false ? 'bg-blue-600 text-white border-blue-600' : 'bg-white'}`}>No</button></div>
                                        </div>
                                    )}

                                    <div className="flex justify-between mt-8 pt-6 border-t border-slate-100">
                                        <button onClick={() => setSubsidyStep(2)} className="text-slate-400 hover:text-slate-600 font-bold text-sm">Back</button>
                                        <button onClick={() => setSubsidyStep(5)} className="bg-blue-900 text-white px-6 py-2.5 rounded-xl font-bold hover:bg-blue-800 transition">Next Step</button>
                                    </div>
                                </div>
                            )}

                            {subsidyStep === 5 && (
                                <div className="text-center py-4">
                                    <h3 className="text-xl font-bold mb-6">{tt.step5.msg}</h3>
                                    <div className="space-y-3 mb-8">
                                        {calculateSubsidies().map((item, idx) => (
                                            <div key={idx} className="bg-green-50 border border-green-200 p-4 rounded-xl flex items-center gap-4 text-left">
                                                <div className="bg-white p-2 rounded-full text-green-600"><CheckCircle size={20} /></div>
                                                <div>
                                                    <h4 className="font-bold text-green-900">{item.title}</h4>
                                                    <p className="text-xs text-green-700">{item.desc}</p>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                    <button onClick={() => setSubsidyStep(6)} className="w-full bg-green-500 text-slate-900 px-6 py-3 rounded-xl font-bold hover:bg-green-400 transition">Proceed to Claim</button>
                                </div>
                            )}

                            {subsidyStep === 6 && (
                                <div className="text-center py-8">
                                    <div className="w-20 h-20 bg-blue-50 text-blue-600 rounded-full flex items-center justify-center mx-auto mb-6"><FileText size={32} /></div>
                                    <h3 className="text-2xl font-bold mb-8">{tt.step6.title}</h3>
                                    <div className="grid gap-3">
                                        <button className="w-full p-4 bg-blue-900 text-white rounded-xl font-bold hover:bg-blue-800 transition flex items-center justify-center gap-2"><Send size={18}/> {tt.step6.btn1}</button>
                                        <button className="w-full p-4 border border-slate-200 text-slate-600 rounded-xl font-bold hover:bg-slate-50 transition flex items-center justify-center gap-2"><HelpCircle size={18}/> {tt.step6.btn2}</button>
                                    </div>
                                    <button onClick={() => setCurrentView('dashboard')} className="mt-8 text-slate-400 hover:text-slate-600 text-sm font-bold">Return to Dashboard</button>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );

            const VsmeView = () => {
                if (vsmeViewMode === 'setup') {
                    return (
                        <div className="max-w-2xl mx-auto pt-24 px-4 animate-fade-in">
                            <button onClick={() => setCurrentView('dashboard')} className="mb-6 text-slate-400 hover:text-slate-900 flex items-center gap-2 font-bold text-sm"><ArrowLeft size={16} /> Back</button>
                            <div className="bg-white p-8 rounded-[2rem] shadow-xl border border-slate-100">
                                <h2 className="text-2xl font-black mb-6">VSME Report Configuration</h2>
                                <div className="space-y-6">
                                    <div>
                                        <label className="block text-xs font-bold uppercase text-slate-400 mb-2">Listed Company?</label>
                                        <div className="flex gap-3">
                                            <button onClick={()=>handleVsmeChange('isListed','yes')} className={`flex-1 py-3 rounded-xl font-bold border transition ${vsmeData.isListed==='yes'?'bg-red-50 border-red-500 text-red-700':'bg-white border-slate-200 text-slate-600'}`}>Yes</button>
                                            <button onClick={()=>handleVsmeChange('isListed','no')} className={`flex-1 py-3 rounded-xl font-bold border transition ${vsmeData.isListed==='no'?'bg-green-50 border-green-500 text-green-700':'bg-white border-slate-200 text-slate-600'}`}>No</button>
                                        </div>
                                    </div>
                                    <div>
                                        <label className="block text-xs font-bold uppercase text-slate-400 mb-2">Report Purpose</label>
                                        <select className="w-full p-3 border border-slate-200 rounded-xl bg-white focus:outline-none focus:ring-2 ring-blue-100" value={vsmeData.reportPurpose} onChange={(e)=>handleVsmeChange('reportPurpose', e.target.value)}>
                                            <option value="basic">Internal Transparency</option>
                                            <option value="partner">Bank Loan Application</option>
                                        </select>
                                    </div>
                                    <button onClick={startVsme} disabled={vsmeData.isListed==='yes'} className="w-full bg-blue-600 text-white font-bold py-4 rounded-xl shadow-lg hover:bg-blue-700 transition disabled:opacity-50">Start Wizard</button>
                                </div>
                            </div>
                        </div>
                    );
                }
                
                if (vsmeViewMode === 'wizard') {
                    const step = vsmeStepsList[vsmeStepIndex];
                    return (
                        <div className="max-w-3xl mx-auto pt-20 px-4 animate-fade-in">
                            <div className="bg-white rounded-[1.5rem] shadow-xl border border-slate-100 overflow-hidden">
                                <div className="bg-slate-900 p-6 flex justify-between items-center text-white">
                                    <h3 className="font-bold flex items-center gap-2"><FileBarChart size={18}/> VSME Generator</h3>
                                    <span className="text-xs font-mono opacity-60">STEP {vsmeStepIndex + 1} / {vsmeStepsList.length}</span>
                                </div>
                                <div className="w-full bg-slate-100 h-1"><div className="bg-blue-500 h-1 transition-all duration-300" style={{width: `${((vsmeStepIndex+1)/vsmeStepsList.length)*100}%`}}></div></div>
                                <div className="p-8">
                                    <div className="space-y-6 min-h-[300px]">
                                        {step === 'gen' && (
                                            <div>
                                                <h4 className="text-lg font-bold mb-4">Company Details</h4>
                                                <div className="grid grid-cols-2 gap-4">
                                                    <input className="p-3 border rounded-xl" placeholder="Company Name" value={vsmeData.b1_name} onChange={e=>handleVsmeChange('b1_name',e.target.value)} />
                                                    <input className="p-3 border rounded-xl" placeholder="Employees" value={vsmeData.b1_employees} onChange={e=>handleVsmeChange('b1_employees',e.target.value)} />
                                                    <input className="p-3 border rounded-xl" placeholder="Turnover (€)" value={vsmeData.b1_turnover} onChange={e=>handleVsmeChange('b1_turnover',e.target.value)} />
                                                </div>
                                            </div>
                                        )}
                                        {/* Placeholder for other steps - functionality remains same as logical core */}
                                        {step === 'generate' && (
                                            <div className="text-center pt-10">
                                                <CheckCircle className="w-16 h-16 text-green-500 mx-auto mb-4" />
                                                <h3 className="text-2xl font-bold mb-2">Ready!</h3>
                                                <p className="text-slate-500 mb-8">Data validation complete.</p>
                                                <button onClick={()=>{saveReport(); setVsmeViewMode('report')}} className="bg-blue-600 text-white px-8 py-3 rounded-xl font-bold shadow-lg">Generate PDF</button>
                                            </div>
                                        )}
                                        {step !== 'generate' && step !== 'gen' && (
                                            <div className="text-center py-20 text-slate-400">Step content placeholder for {step}</div>
                                        )}
                                    </div>
                                    {step !== 'generate' && (
                                        <div className="flex justify-between pt-6 mt-6 border-t border-slate-50">
                                            <button onClick={()=>{if(vsmeStepIndex>0)setVsmeStepIndex(i=>i-1); else setVsmeViewMode('setup')}} className="text-slate-400 font-bold hover:text-slate-600">Back</button>
                                            <button onClick={()=>setVsmeStepIndex(i=>i+1)} className="bg-slate-900 text-white px-6 py-2 rounded-lg font-bold hover:bg-slate-800">Next</button>
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    );
                }

                if (vsmeViewMode === 'report') {
                    return (
                        <div className="max-w-4xl mx-auto pt-10 px-4 animate-fade-in pb-20">
                            <div className="flex justify-between mb-8 print:hidden">
                                <button onClick={()=>setVsmeViewMode('setup')} className="font-bold flex items-center gap-2 text-slate-500 hover:text-slate-900"><ArrowLeft size={16}/> New Report</button>
                                <button onClick={()=>window.print()} className="bg-blue-600 text-white px-6 py-2 rounded-xl font-bold shadow-lg">Download PDF</button>
                            </div>
                            <div className="bg-white p-16 shadow-2xl min-h-[297mm] w-full text-slate-900">
                                <div className="border-b-2 border-slate-900 pb-8 mb-12 flex justify-between items-end">
                                    <div>
                                        <h1 className="text-4xl font-black uppercase tracking-tight">VSME Report</h1>
                                        <p className="font-medium text-slate-500 mt-2">Voluntary SME Standard 2026</p>
                                    </div>
                                    <div className="text-right">
                                        <p className="font-bold">{vsmeData.b1_name}</p>
                                        <p className="text-sm text-slate-500">{new Date().toLocaleDateString()}</p>
                                    </div>
                                </div>
                                <div className="grid grid-cols-2 gap-12 mb-12">
                                    <div>
                                        <h4 className="text-xs font-black uppercase tracking-widest text-slate-400 mb-4">General Disclosures</h4>
                                        <div className="space-y-2 text-sm">
                                            <div className="flex justify-between border-b border-slate-100 pb-1"><span>Employees</span> <span className="font-bold">{vsmeData.b1_employees}</span></div>
                                            <div className="flex justify-between border-b border-slate-100 pb-1"><span>Turnover</span> <span className="font-bold">€{vsmeData.b1_turnover}</span></div>
                                        </div>
                                    </div>
                                    <div>
                                        <h4 className="text-xs font-black uppercase tracking-widest text-slate-400 mb-4">Environmental</h4>
                                        <div className="space-y-2 text-sm">
                                            <div className="flex justify-between border-b border-slate-100 pb-1"><span>Energy Consumption</span> <span className="font-bold">{vsmeData.b3_energy_total} MWh</span></div>
                                            <div className="flex justify-between border-b border-slate-100 pb-1"><span>Scope 1 Emissions</span> <span className="font-bold">{vsmeData.b3_scope1} tCO2e</span></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    );
                }
            };

            return (
                <div className="flex w-full h-full bg-slate-50">
                    <Sidebar />
                    <div className="flex-1 flex flex-col h-full overflow-hidden">
                        <Topbar />
                        <main className="flex-1 overflow-y-auto">
                            {currentView === 'dashboard' && <DashboardView />}
                            {currentView === 'subsidy' && <SubsidyView />}
                            {currentView === 'vsme' && <VsmeView />}
                        </main>
                    </div>
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>